(function($) {
    "use strict";

    function showSuccessMessage(message) {
        return '<div class="alert alert-success fade in show" role="alert">' +
                    '<div><span class="fa fa-check"></span></div>' +
                    message +
                '</div>';
    }

    function showErrorMessage(message) {
        return '<div class="alert alert-danger fade in show" role="alert">' +
                    '<div><span class="fa fa-exclamation"></span></div>' +
                    message +
                '</div>';
    }

    function urlParam(name) {
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        if (results == null) {
           return null;
        } else {
           return results[1] || 0;
        }
    }

    function getPathFromUrl(url) {
        return url.split("?")[0];
    }

    function fixedEncodeURIComponent(str) {
        return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
            return '%' + c.charCodeAt(0).toString(16);
        });
    }

    function jsonParser(str) {
        try {
          return JSON.parse(str);
        } catch(ex) {
          return null;
        }
    }

    function userSignin() {
        var message;
        $('.pxp-signin-modal-btn').addClass('disabled');
        $('.pxp-signin-modal-btn-text').hide();
        $('.pxp-signin-modal-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'     : 'jobster_user_signin',
                'signin_user': $('#pxp-signin-modal-email').val(),
                'signin_pass': $('#pxp-signin-modal-password').val(),
                'security'   : $('#pxp-signin-modal-security').val()
            },
            success: function(data) {
                $('.pxp-signin-modal-btn').removeClass('disabled');
                $('.pxp-signin-modal-btn-loading').hide();
                $('.pxp-signin-modal-btn-text').show();

                if (data.signedin === true) {
                    message = showSuccessMessage(data.message);

                    $('.pxp-signin-modal-message').empty().append(message).fadeIn('slow');
                    document.location.href = $('#pxp-signin-modal-redirect').val();
                } else {
                    message = showErrorMessage(data.message);

                    $('.pxp-signin-modal-message').empty().append(message).fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    }

    function userSignup() {
        $('.pxp-signup-modal-btn').addClass('disabled');
        $('.pxp-signup-modal-btn-text').hide();
        $('.pxp-signup-modal-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'          : 'jobster_user_signup',
                'signup_firstname': $('#pxp-signup-modal-firstname').val(),
                'signup_lastname' : $('#pxp-signup-modal-lastname').val(),
                'signup_company'  : $('#pxp-signup-modal-company-name').val(),
                'signup_email'    : $('#pxp-signup-modal-email').val(),
                'signup_pass'     : $('#pxp-signup-modal-password').val(),
                'user_type'       : $('[name=pxp-signup-modal-type-switcher]:checked').attr('data-type'),
                'terms'           : $('#pxp-signup-modal-terms').is(':checked'),
                'security'        : $('#pxp-signup-modal-security').val()
            },
            success: function(data) {
                $('.pxp-signup-modal-btn').removeClass('disabled');
                $('.pxp-signup-modal-btn-loading').hide();
                $('.pxp-signup-modal-btn-text').show();

                if (data.signedup === true) {
                    var message = showSuccessMessage(data.message);

                    $('#pxp-signup-modal').modal('hide');
                    $('#pxp-signin-modal').modal('show').on('shown.bs.modal', function(e) {
                        $('.pxp-signin-modal-message').empty().append(message).fadeIn('slow');
                    });
                } else {
                    var message = showErrorMessage(data.message);

                    $('.pxp-signup-modal-message').empty().append(message).fadeIn('slow');
                }
            },
            error: function(errorThrown) {

            }
        });
    }

    function forgotPassword() {
        $('.pxp-forgot-modal-btn').addClass('disabled');
        $('.pxp-forgot-modal-btn-text').hide();
        $('.pxp-forgot-modal-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'      : 'jobster_forgot_password',
                'forgot_email': $('#pxp-forgot-modal-email').val(),
                'security'    : $('#pxp-forgot-modal-security').val()
            },

            success: function(data) {
                $('.pxp-forgot-modal-btn').removeClass('disabled');
                $('.pxp-forgot-modal-btn-loading').hide();
                $('.pxp-forgot-modal-btn-text').show();
                $('#pxp-forgot-modal-email').val('');

                if (data.sent === true) {
                    var message = showSuccessMessage(data.message);

                    $('.pxp-forgot-modal-message').empty().append(message).fadeIn('slow');
                } else {
                    var message = showErrorMessage(data.message);

                    $('.pxp-forgot-modal-message').empty().append(message).fadeIn('slow');
                }
            },
            error: function(errorThrown) {

            }
        });
    }

    function resetPassword() {
        $('.pxp-reset-modal-btn').addClass('disabled');
        $('.pxp-reset-modal-btn-text').hide();
        $('.pxp-reset-modal-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'  : 'jobster_reset_password',
                'pass'    : $('#pxp-reset-modal-password').val(),
                'key'     : urlParam('key'),
                'login'   : urlParam('login'),
                'security': $('#pxp-reset-modal-security').val()
            },

            success: function(data) {
                $('.pxp-reset-modal-btn').removeClass('disabled');
                $('.pxp-reset-modal-btn-loading').hide();
                $('.pxp-reset-modal-btn-text').show();
                $('#pxp-reset-modal-password').val('');

                if (data.reset === true) {
                    var message = showSuccessMessage(data.message);

                    $('#pxp-reset-modal').modal('hide');
                    $('#pxp-signin-modal').modal('show').on('shown.bs.modal', function(e) {
                        $('.pxp-signin-modal-message').empty().append(message).fadeIn('slow');
                    });
                } else {
                    var message = showErrorMessage(data.message);

                    $('.pxp-reset-modal-message').empty().append(message).fadeIn('slow');
                }
            },
            error: function(errorThrown) {

            }
        });
    }

    /* Signin Modal */
    $('.pxp-signin-trigger').click(function() {
        $('#pxp-signup-modal').modal('hide');
        $('#pxp-signin-modal').modal('show');
    });
    $('#pxp-signin-modal').on('shown.bs.modal', function () {
        $('body').addClass('modal-open');
        $('#pxp-signin-modal-redirect').val(window.location.href.split(/\?|#/)[0]);
    });
    $('#pxp-signin-modal').on('hidden.bs.modal', function(e) {
        $('.pxp-signin-modal-message').empty();
        $('#pxp-signin-modal-email').val('');
        $('#pxp-signin-modal-password').val('');
    });
    $('.pxp-signin-modal-btn').click(function() {
        userSignin();
    });
    $('#pxp-signin-modal-email, #pxp-signin-modal-password').keydown(function(e) {
        if (e.keyCode === 13) {
            e.preventDefault();
            userSignin();
        }
    });

    /* Signup Modal */
    $('.pxp-signup-trigger').click(function() {
        $('#pxp-signin-modal').modal('hide');
        $('#pxp-signup-modal').modal('show');
    });
    
    $('#pxp-signup-modal').on('shown.bs.modal', function () {
        $('body').addClass('modal-open');
    });
    $('#pxp-signup-modal').on('hidden.bs.modal', function(e) {
        $('.pxp-signup-modal-message').empty();
        $('#pxp-signup-modal-firstname').val('');
        $('#pxp-signup-modal-lastname').val('');
        $('#pxp-signup-modal-company').val('');
        $('#pxp-signup-modal-email').val('');
        $('#pxp-signup-modal-password').val('');
    });
    $('.pxp-signup-modal-btn').click(function() {
        userSignup();
    });
    $('#pxp-signup-modal-firstname, #pxp-signup-modal-lastname, #pxp-signup-modal-company, #pxp-signup-modal-email, #pxp-signup-modal-password').keydown(function(e) {
        if (e.keyCode === 13) {
            e.preventDefault();
            userSignup();
        }
    });

    /* Forgot Password Modal */
    $('.pxp-forgot-trigger').click(function() {
        $('#pxp-signin-modal').modal('hide');
        $('#pxp-forgot-modal').modal('show');
    });
    $('#pxp-forgot-modal').on('shown.bs.modal', function () {
        $('body').addClass('modal-open');
    });
    $('#pxp-forgot-modal').on('hidden.bs.modal', function(e) {
        $('.pxp-forgot-modal-message').empty();
        $('#pxp-forgot-modal-email').val('');
    });
    $('.pxp-forgot-modal-btn').click(function() {
        forgotPassword();
    });
    $('#pxp-forgot-modal-email').keydown(function(e) {
        if (e.keyCode === 13) {
            e.preventDefault();
            forgotPassword();
        }
    });

    /* Reset Password Modal */
    if (urlParam('action') && urlParam('action') == 'rp') {
        $('#pxp-reset-modal').modal('show');
    }
    $('#pxp-reset-modal').on('hidden.bs.modal', function(e) {
        $('.pxp-reset-modal-message').empty();
        $('#pxp-reset-modal-password').val('');
    });
    $('.pxp-reset-modal-btn').click(function() {
        resetPassword();
    });
    $('#pxp-reset-modal-password').keydown(function(e) {
        if (e.keyCode === 13) {
            e.preventDefault();
            resetPassword();
        }
    });

    // Save/Remove job to/from candidate favs
    $('.pxp-single-job-save-btn').on('click', function() {
        var _self = $(this);
        var saved = _self.attr('data-saved');

        if (saved == 'true') {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'  : 'jobster_candidate_remove_fav',
                    'job_ids' : [_self.attr('data-pid')],
                    'security': $('#pxp-single-job-favs-security').val()
                },
                success: function(data) {
                    if (data.removed === true) {
                        _self
                        .removeClass('pxp-saved')
                        .attr('data-saved', 'false')
                        .html(
                            `<span class="fa fa-heart-o"></span>`
                        );
                    }
                },
                error: function(errorThrown) {}
            });
        } else {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'  : 'jobster_candidate_add_fav',
                    'job_id'  : _self.attr('data-pid'),
                    'security': $('#pxp-single-job-favs-security').val()
                },
                success: function(data) {
                    if (data.saved === true) {
                        _self
                        .addClass('pxp-saved')
                        .attr('data-saved', 'true')
                        .html(
                            `<span class="fa fa-heart"></span>`
                        );
                    }
                },
                error: function(errorThrown) {}
            });
        }
    });

    // Manage candidate job application
    $('.pxp-single-job-apply-btn').on('click', function() {
        var _self = $(this);
        var saved = _self.attr('data-saved');

        if (saved == 'false') {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'  : 'jobster_job_apply',
                    'job_id'  : _self.attr('data-pid'),
                    'security': $('#pxp-single-job-apps-security').val()
                },
                success: function(data) {
                    if (data.saved === true) {
                        $('.pxp-single-job-apply-btn')
                        .addClass('pxp-saved')
                        .attr('data-saved', 'true')
                        .attr('disabled', 'disabled')
                        .html(
                            `<span class="fa fa-check"></span>
                            ${services_vars.applied}`
                        );
                    }
                },
                error: function(errorThrown) {}
            });
        }
    });

    // Manage single company page - contact form
    $('.pxp-single-company-contact-btn').on('click', function() {
        var message;
        $(this).addClass('disabled');
        $('.pxp-single-company-contact-btn-text').hide();
        $('.pxp-single-company-contact-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'       : 'jobster_contact_company',
                'user_id'      : $('#pxp-single-company-contact-user-id').val(),
                'candidate_id' : $('#pxp-single-company-contact-candidate-id').val(),
                'company_id'   : $('#pxp-single-company-contact-company-id').val(),
                'name'         : $('#pxp-single-company-contact-name').val(),
                'email'        : $('#pxp-single-company-contact-email').val(),
                'company_email': $('#pxp-single-company-contact-company-email').val(),
                'message'      : $('#pxp-single-company-contact-message').val(),
                'security'     : $('#pxp-single-company-contact-security').val()
            },
            success: function(data) {
                $('.pxp-single-company-contact-btn').removeClass('disabled');
                $('.pxp-single-company-contact-btn-loading').hide();
                $('.pxp-single-company-contact-btn-text').show();

                if (data.sent === true) {
                    message = showSuccessMessage(data.message);

                    $('.pxp-single-company-contact-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                } else {
                    message = showErrorMessage(data.message);

                    $('.pxp-single-company-contact-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Manage single candidate page - contact form
    $('.pxp-single-candidate-contact-btn').on('click', function() {
        var message;
        $(this).addClass('disabled');
        $('.pxp-single-candidate-contact-btn-text').hide();
        $('.pxp-single-candidate-contact-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'         : 'jobster_contact_candidate',
                'user_id'        : $('#pxp-single-candidate-contact-user-id').val(),
                'candidate_id'   : $('#pxp-single-candidate-contact-candidate-id').val(),
                'company_id'     : $('#pxp-single-candidate-contact-company-id').val(),
                'name'           : $('#pxp-single-candidate-contact-name').val(),
                'email'          : $('#pxp-single-candidate-contact-email').val(),
                'candidate_email': $('#pxp-single-candidate-contact-candidate-email').val(),
                'message'        : $('#pxp-single-candidate-contact-message').val(),
                'security'       : $('#pxp-single-candidate-contact-security').val()
            },
            success: function(data) {
                $('.pxp-single-candidate-contact-btn').removeClass('disabled');
                $('.pxp-single-candidate-contact-btn-loading').hide();
                $('.pxp-single-candidate-contact-btn-text').show();

                if (data.sent === true) {
                    message = showSuccessMessage(data.message);

                    $('.pxp-single-candidate-contact-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                } else {
                    message = showErrorMessage(data.message);

                    $('.pxp-single-candidate-contact-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Set company notifications as read when click on bell icon
    $('.pxp-company-notifications > a').on('click', function() {
        var companyId = $(this).attr('data-id');
        var _self = $(this);

        if (_self.find('.pxp-user-notifications-counter').length > 0) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'    : 'jobster_set_company_read_notifications',
                    'company_id': companyId,
                    'security'  : $('#pxp-notifications-security').val()
                },
                success: function(data) {
                    if (data.set === true) {
                        _self.find('.pxp-user-notifications-counter').remove();
                        $('.badge.pxp-unread-notificatons').remove();
                        $('.pxp-dashboard-stats-card-info-number.pxp-is-notify').text('0');
                        _self.next('ul').find('li').removeClass('pxp-unread');
                    }
                },
                error: function(errorThrown) {}
            });
        }
    });

    // Company dashboard charts
    if ($('#pxp-company-dashboard-visitors-chart').length > 0) {
        var companyVisitsChartElem = document
                                    .getElementById('pxp-company-dashboard-visitors-chart')
                                    .getContext('2d');

        var gradient = companyVisitsChartElem.createLinearGradient(0, 250, 0, 0);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
        gradient.addColorStop(.5, 'rgba(0, 112, 201, 0.09)');
        gradient.addColorStop(1, 'rgba(0, 112, 201, 0.12)');

        var companyVisitsChart = new Chart(companyVisitsChartElem, {
            type: 'line',
            data: {
                labels: ['', '', '', '', '', '', ''],
                datasets: [{
                    label: services_vars.visitors,
                    data: [0, 0, 0, 0, 0, 0, 0],
                    borderWidth: 3,
                    borderColor: 'rgba(0, 112, 201, 1)',
                    pointBackgroundColor: 'rgba(255, 255, 255, 0)',
                    pointHoverBackgroundColor: 'rgba(255, 255, 255, 1)',
                    pointBorderColor: 'rgba(66, 133, 244, 0)',
                    pointHoverBorderColor: 'rgba(0, 112, 201, 1)',
                    pointBorderWidth: 10,
                    pointHoverBorderWidth: 3,
                    pointHitRadius: 20,
                    cubicInterpolationMode: 'monotone',
                    fill: true,
                    backgroundColor: gradient
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            fontColor: 'rgba(153, 153, 153, 1)',
                            maxTicksLimit: 7,
                            maxRotation: 0
                        },
                        gridLines: {
                            zeroLineColor: 'rgba(232, 232, 232, 1)',
                            drawOnChartArea: false,
                        },
                    }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            fontColor: 'rgba(153, 153, 153, 1)',
                            callback: function(value, index, values) {
                                if (Math.floor(value) === value) {
                                    return value;
                                }
                            }
                        },
                        gridLines: {
                            zeroLineColor: 'rgba(232, 232, 232, 0)',
                        },
                    }],
                },
                responsive: true,
                tooltips: {
                    backgroundColor: 'rgba(0, 39, 69, 1)',
                    cornerRadius: 7,
                    mode: 'index',
                    intersect: false,
                    displayColors: false,
                    xPadding: 10,
                    yPadding: 10,
                    titleFontColor: 'rgba(255, 255, 255, .7)',
                    bodyFontColor: 'rgba(255, 255, 255, 1)',
                    titleFontStyle: 'normal',
                    bodyFontStyle: 'bold',
                },
                legend: {
                    display: false,
                }
            }
        });
    }

    function getCompanyVisitorsByPeriod(period = '-7 days') {
        if ($('#pxp-company-dashboard-visitors-chart').length > 0) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'  : 'jobster_get_jobs_visitors',
                    'company_id': $('#pxp-company-id').val(),
                    'period'  : period,
                    'security': $('#pxp-charts-security').val()
                },
                success: function(data) {
                    if (data.getvisitors === true) {
                        var visitors_no = [];
                        var visitors_dates = [];
                        var percent;
                        var versus = {
                            '-7 days'   : services_vars.vs_7_days,
                            '-30 days'  : services_vars.vs_30_days,
                            '-60 days'  : services_vars.vs_60_days,
                            '-90 days'  : services_vars.vs_90_days,
                            '-12 months': services_vars.vs_12_months,
                        };

                        $.each(data.visitors, function(date, visitor) {
                            visitors_no.push(visitor);
                            visitors_dates.push(date);
                        });

                        companyVisitsChart.data.labels = visitors_dates;
                        companyVisitsChart.data.datasets[0].data = visitors_no;

                        companyVisitsChart.update();

                        $('.pxp-company-dashboard-visitors-chart-percent')
                        .removeClass('text-success')
                        .removeClass('text-danger');
                        $('.pxp-company-dashboard-visitors-number-total')
                        .text(data.total_visitors);

                        if (data.total_visitors_prev == 0) {
                            percent = parseInt(data.total_visitors) * 100;
                        } else {
                            percent = (
                                (parseInt(data.total_visitors) - parseInt(data.total_visitors_prev)) * 100
                            ) / parseInt(data.total_visitors_prev);
                        }

                        if (percent >= 0) {
                            $('.pxp-company-dashboard-visitors-chart-percent')
                            .addClass('text-success')
                            .html(`<span class="fa fa-long-arrow-up"></span> ${Math.abs(percent.toFixed(1))}%`);
                        } else {
                            $('.pxp-company-dashboard-visitors-chart-percent')
                            .addClass('text-danger')
                            .html(`<span class="fa fa-long-arrow-down"></span> ${Math.abs(percent.toFixed(1))}%`);
                        }

                        $('.pxp-company-dashboard-visitors-vs').html(versus[period]);
                    }
                },
                error: function(errorThrown) {}
            });
        }
    }

    getCompanyVisitorsByPeriod();

    $('#pxp-company-visitors-period').on('change', function() {
        getCompanyVisitorsByPeriod($(this).val());
    });

    if ($('#pxp-company-dashboard-apps-chart').length > 0) {
        var companyAppsChartElem =  document
                                    .getElementById('pxp-company-dashboard-apps-chart')
                                    .getContext('2d');

        var gradient = companyAppsChartElem.createLinearGradient(0, 250, 0, 0);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
        gradient.addColorStop(.5, 'rgba(255, 168, 35, 0.09)');
        gradient.addColorStop(1, 'rgba(255, 168, 35, 0.12)');

        var companyAppsChart = new Chart(companyAppsChartElem, {
            type: 'line',
            data: {
                labels: ['', '', '', '', '', '', ''],
                datasets: [{
                    label: services_vars.applications,
                    data: [0, 0, 0, 0, 0, 0, 0],
                    borderWidth: 3,
                    borderColor: 'rgba(255, 168, 35, 1)',
                    pointBackgroundColor: 'rgba(255, 255, 255, 0)',
                    pointHoverBackgroundColor: 'rgba(255, 255, 255, 1)',
                    pointBorderColor: 'rgba(66, 133, 244, 0)',
                    pointHoverBorderColor: 'rgba(255, 168, 35, 1)',
                    pointBorderWidth: 10,
                    pointHoverBorderWidth: 3,
                    pointHitRadius: 20,
                    cubicInterpolationMode: 'monotone',
                    fill: true,
                    backgroundColor: gradient
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            fontColor: 'rgba(153, 153, 153, 1)',
                            maxTicksLimit: 7,
                            maxRotation: 0
                        },
                        gridLines: {
                            zeroLineColor: 'rgba(232, 232, 232, 1)',
                            drawOnChartArea: false,
                        },
                    }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            fontColor: 'rgba(153, 153, 153, 1)',
                            callback: function(value, index, values) {
                                if (Math.floor(value) === value) {
                                    return value;
                                }
                            }
                        },
                        gridLines: {
                            zeroLineColor: 'rgba(232, 232, 232, 0)',
                        },
                    }],
                },
                responsive: true,
                tooltips: {
                    backgroundColor: 'rgba(0, 39, 69, 1)',
                    cornerRadius: 7,
                    mode: 'index',
                    intersect: false,
                    displayColors: false,
                    xPadding: 10,
                    yPadding: 10,
                    titleFontColor: 'rgba(255, 255, 255, .7)',
                    bodyFontColor: 'rgba(255, 255, 255, 1)',
                    titleFontStyle: 'normal',
                    bodyFontStyle: 'bold',
                },
                legend: {
                    display: false,
                }
            }
        });
    }

    function getAppsByPeriod(period = '-7 days') {
        if ($('#pxp-company-dashboard-apps-chart').length > 0) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'  : 'jobster_get_company_jobs_apps',
                    'company_id': $('#pxp-company-id').val(),
                    'period'  : period,
                    'security': $('#pxp-charts-security').val()
                },
                success: function(data) {
                    if (data.getapps === true) {
                        var apps_no = [];
                        var apps_dates = [];
                        var percent;
                        var versus = {
                            '-7 days'   : services_vars.vs_7_days,
                            '-30 days'  : services_vars.vs_30_days,
                            '-60 days'  : services_vars.vs_60_days,
                            '-90 days'  : services_vars.vs_90_days,
                            '-12 months': services_vars.vs_12_months,
                        };

                        $.each(data.apps, function(date, app) {
                            apps_no.push(app);
                            apps_dates.push(date);
                        });

                        companyAppsChart.data.labels = apps_dates;
                        companyAppsChart.data.datasets[0].data = apps_no;

                        companyAppsChart.update();

                        $('.pxp-company-dashboard-apps-chart-percent')
                        .removeClass('text-success')
                        .removeClass('text-danger');
                        $('.pxp-company-dashboard-apps-number-total')
                        .text(data.total_apps);

                        if (data.total_apps_prev == 0) {
                            percent = parseInt(data.total_apps) * 100;
                        } else {
                            percent = (
                                (parseInt(data.total_apps) - parseInt(data.total_apps_prev)) * 100
                            ) / parseInt(data.total_apps_prev);
                        }

                        if (percent >= 0) {
                            $('.pxp-company-dashboard-apps-chart-percent')
                            .addClass('text-success')
                            .html(`<span class="fa fa-long-arrow-up"></span> ${Math.abs(percent.toFixed(1))}%`);
                        } else {
                            $('.pxp-company-dashboard-apps-chart-percent')
                            .addClass('text-danger')
                            .html(`<span class="fa fa-long-arrow-down"></span> ${Math.abs(percent.toFixed(1))}%`);
                        }

                        $('.pxp-company-dashboard-apps-vs').html(versus[period]);
                    }
                },
                error: function(errorThrown) {}
            });
        }
    }

    getAppsByPeriod();

    $('#pxp-company-apps-period').on('change', function() {
        getAppsByPeriod($(this).val());
    });

    function getTinymceContent(id) {
        if ($('.pxp-is-tinymce').length > 0) {
            var content;
            var inputid = id;

            tinyMCE.triggerSave();

            var editor = tinyMCE.get(inputid);
            var textArea = jQuery('textarea#' + inputid);

            if (textArea.length > 0 && textArea.is(':visible')) {
                content = textArea.val();
            } else {
                content = editor.getContent();
            }

            return content;
        } else {
            return '';
        }
    }

    // Manage update company profile
    $('.pxp-company-profile-update-btn').on('click', function() {
        var message;
        $(this).addClass('disabled');
        $('.pxp-company-profile-update-btn-text').hide();
        $('.pxp-company-profile-update-btn-loading').show();
        $('.pxp-is-required').removeClass('is-invalid');

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'    : 'jobster_update_company_profile',
                'company_id': $('#pxp-company-profile-id').val(),
                'name'      : $('#pxp-company-profile-name').val(),
                'email'     : $('#pxp-company-profile-email').val(),
                'phone'     : $('#pxp-company-profile-phone').val(),
                'website'   : $('#pxp-company-profile-website').val(),
                'cover'     : $('#pxp-dashboard-cover').val(),
                'logo'      : $('#pxp-dashboard-logo').val(),
                'about'     : getTinymceContent('pxp-company-profile-about'),
                'industry'  : $('#pxp-company-profile-industry').val(),
                'location'  : $('#pxp-company-profile-location').val(),
                'founded'   : $('#pxp-company-profile-founded').val(),
                'size'      : $('#pxp-company-profile-size').val(),
                'facebook'  : $('#pxp-company-profile-facebook').val(),
                'twitter'   : $('#pxp-company-profile-twitter').val(),
                'instagram' : $('#pxp-company-profile-instagram').val(),
                'linkedin'  : $('#pxp-company-profile-linkedin').val(),
                'app_notify': $('#pxp-company-profile-app-notify:checked').val(),
                'security'  : $('#pxp-company-profile-security').val()
            },
            success: function(data) {
                $('.pxp-company-profile-update-btn').removeClass('disabled');
                $('.pxp-company-profile-update-btn-loading').hide();
                $('.pxp-company-profile-update-btn-text').show();

                if (data.update === true) {
                    document.location.href = services_vars.company_profile_url;
                } else {
                    if (data.field) {
                        $(`#${data.field}`).addClass('is-invalid');
                    }

                    message = showErrorMessage(data.message);

                    $('.pxp-company-profile-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Manage save new job
    $('.pxp-company-new-job-save-btn').on('click', function() {
        var message;
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.pxp-company-new-job-save-btn-text').hide();
        _self.find('.pxp-company-new-job-save-btn-loading').show();
        $('.pxp-is-required').removeClass('is-invalid');

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'     : 'jobster_save_new_job',
                'company_id' : $('#pxp-company-new-job-company-id').val(),
                'title'      : $('#pxp-company-new-job-title').val(),
                'category'   : $('#pxp-company-new-job-category').val(),
                'location'   : $('#pxp-company-new-job-location').val(),
                'cover'      : $('#pxp-dashboard-cover').val(),
                'description': getTinymceContent('pxp-company-new-job-description'),
                'type'       : $('#pxp-company-new-job-type').val(),
                'level'      : $('#pxp-company-new-job-level').val(),
                'experience' : $('#pxp-company-new-job-experience').val(),
                'salary'     : $('#pxp-company-new-job-salary').val(),
                'draft'      : _self.hasClass('pxp-is-draft'),
                'security'   : $('#pxp-company-new-job-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-company-new-job-save-btn-loading').hide();
                _self.find('.pxp-company-new-job-save-btn-text').show();

                if (data.save === true) {
                    document.location.href = services_vars.company_jobs_url;
                } else {
                    if (data.field) {
                        $(`#${data.field}`).addClass('is-invalid');
                    }

                    message = showErrorMessage(data.message);

                    $('.pxp-company-new-job-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Manage jobs - bulk actions
    $('.pxp-company-dashboard-check-all-jobs').on('change', function() {
        let checks = document.querySelectorAll('.pxp-company-dashboard-check');

        if ($(this).is(':checked')) {
            checks.forEach(elem => {
                elem.checked = true;
            });
        } else {
            checks.forEach(elem => {
                elem.checked = false;
            });
        }
    });
    $('#pxp-company-dashboard-jobs-bulk-actions').on('change', function() {
        if ($(this).val() == 'publish' || $(this).val() == 'delete') {
            $('.pxp-company-dashboard-jobs-bulk-actions-apply').removeClass('disabled');
        } else {
            $('.pxp-company-dashboard-jobs-bulk-actions-apply').addClass('disabled');
        }
    });
    $('.pxp-company-dashboard-jobs-bulk-actions-apply').on('click', function() {
        var action = $('#pxp-company-dashboard-jobs-bulk-actions').val();
        var jobs = [];
        var _self = $(this);

        if (action == 'publish') {
            $('.pxp-company-dashboard-check').each(function() {
                if ($(this).is(':checked')) {
                    jobs.push($(this).attr('data-id'));
                }
            });

            if (jobs.length > 0) {
                _self.addClass('disabled');
                _self.find('.pxp-company-dashboard-jobs-bulk-actions-apply-text').hide();
                _self.find('.pxp-company-dashboard-jobs-bulk-actions-apply-loading').show();

                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: services_vars.ajaxurl,
                    data: {
                        'action'  : 'jobster_publish_jobs',
                        'jobs'    : jobs.join(),
                        'security': $('#pxp-company-bulk-jobs-security').val()
                    },
                    success: function(data) {
                        _self.removeClass('disabled');
                        _self.find('.pxp-company-dashboard-jobs-bulk-actions-apply-loading').hide();
                        _self.find('.pxp-company-dashboard-jobs-bulk-actions-apply-text').show();

                        document.location.href = services_vars.company_jobs_url;
                    },
                    error: function(errorThrown) {}
                });
            }
        } else if (action == 'delete') {
            $('.pxp-company-dashboard-check').each(function() {
                if ($(this).is(':checked')) {
                    jobs.push($(this).attr('data-id'));
                }
            });

            if (jobs.length > 0) {
                _self.addClass('disabled');
                _self.find('.pxp-company-dashboard-jobs-bulk-actions-apply-text').hide();
                _self.find('.pxp-company-dashboard-jobs-bulk-actions-apply-loading').show();

                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: services_vars.ajaxurl,
                    data: {
                        'action'  : 'jobster_delete_jobs',
                        'jobs'    : jobs.join(),
                        'security': $('#pxp-company-bulk-jobs-security').val()
                    },
                    success: function(data) {
                        _self.removeClass('disabled');
                        _self.find('.pxp-company-dashboard-jobs-bulk-actions-apply-loading').hide();
                        _self.find('.pxp-company-dashboard-jobs-bulk-actions-apply-text').show();

                        document.location.href = services_vars.company_jobs_url;
                    },
                    error: function(errorThrown) {}
                });
            }
        }
    });
    $('.pxp-company-dashboard-job-delete').on('click', function() {
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.pxp-company-dashboard-job-delete-text').hide();
        _self.find('.pxp-company-dashboard-job-delete-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'  : 'jobster_delete_jobs',
                'jobs'    : _self.attr('data-id'),
                'security': $('#pxp-company-bulk-jobs-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-company-dashboard-job-delete-loading').hide();
                _self.find('.pxp-company-dashboard-job-delete-text').show();

                document.location.href = services_vars.company_jobs_url;
            },
            error: function(errorThrown) {}
        });
    });

    // Manage update existing job
    $('.pxp-company-edit-job-save-btn').on('click', function() {
        var message;
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.pxp-company-edit-job-save-btn-text').hide();
        _self.find('.pxp-company-edit-job-save-btn-loading').show();
        $('.pxp-is-required').removeClass('is-invalid');

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'     : 'jobster_update_job',
                'company_id' : $('#pxp-company-edit-job-company-id').val(),
                'job_id'     : $('#pxp-company-edit-job-id').val(),
                'title'      : $('#pxp-company-edit-job-title').val(),
                'category'   : $('#pxp-company-edit-job-category').val(),
                'location'   : $('#pxp-company-edit-job-location').val(),
                'cover'      : $('#pxp-dashboard-cover').val(),
                'description': getTinymceContent('pxp-company-edit-job-description'),
                'type'       : $('#pxp-company-edit-job-type').val(),
                'level'      : $('#pxp-company-edit-job-level').val(),
                'experience' : $('#pxp-company-edit-job-experience').val(),
                'salary'     : $('#pxp-company-edit-job-salary').val(),
                'draft'      : _self.hasClass('pxp-is-draft'),
                'security'   : $('#pxp-company-edit-job-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-company-edit-job-save-btn-loading').hide();
                _self.find('.pxp-company-edit-job-save-btn-text').show();

                if (data.update === true) {
                    document.location.href = services_vars.company_jobs_url;
                } else {
                    if (data.field) {
                        $(`#${data.field}`).addClass('is-invalid');
                    }

                    message = showErrorMessage(data.message);

                    $('.pxp-company-edit-job-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Company Dashboard - Application status
    $('.pxp-company-dashboard-app-set-status-btn').on('click', function() {
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.fa').hide();
        _self.find('.pxp-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'      : 'jobster_set_app_status',
                'apps'        : [{
                    'job_id'      : _self.attr('data-job-id'),
                    'candidate_id': _self.attr('data-candidate-id')
                }],
                'status'      : _self.attr('data-status'),
                'security'    : $('#pxp-company-candidates-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-btn-loading').hide();
                _self.find('.fa').show();

                if (data.set === true) {
                    var statusContainer =   _self
                                            .parent().parent().parent().parent().parent()
                                            .find('.pxp-company-dashboard-job-status');
                    switch (_self.attr('data-status')) {
                        case 'approved':
                            statusContainer.html(
                                `<span class="badge rounded-pill bg-success">
                                    ${services_vars.approved_status}
                                </span>`
                            );
                            break;
                        case 'rejected':
                            statusContainer.html(
                                `<span class="badge rounded-pill bg-danger">
                                    ${services_vars.rejected_status}
                                </span>`
                            );
                            break;
                        default:
                            statusContainer.html(
                                `<span class="badge rounded-pill bg-secondary">
                                    ${services_vars.na_status}
                                </span>`
                            );
                            break;
                    }
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Company Dashboard - Delete Application
    $('.pxp-company-dashboard-delete-app-btn').on('click', function() {
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.fa').hide();
        _self.find('.pxp-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'      : 'jobster_delete_app',
                'apps'        : [{
                    'job_id'      : _self.attr('data-job-id'),
                    'candidate_id': _self.attr('data-candidate-id')
                }],
                'security'    : $('#pxp-company-candidates-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-btn-loading').hide();
                _self.find('.fa').show();

                if (data.deleted === true) {
                    document.location.href = services_vars.company_candidates_url;
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Manage candidates - bulk actions
    $('.pxp-company-dashboard-check-all-candidates').on('change', function() {
        let checks = document.querySelectorAll('.pxp-company-dashboard-check');

        if ($(this).is(':checked')) {
            checks.forEach(elem => {
                elem.checked = true;
            });
        } else {
            checks.forEach(elem => {
                elem.checked = false;
            });
        }
    });
    $('#pxp-company-dashboard-candidates-bulk-actions')
    .on('change', function() {
        if ($(this).val() == 'approve'
            || $(this).val() == 'reject'
            || $(this).val() == 'delete') {
            $('.pxp-company-dashboard-candidates-bulk-actions-apply')
            .removeClass('disabled');
        } else {
            $('.pxp-company-dashboard-candidates-bulk-actions-apply')
            .addClass('disabled');
        }
    });
    $('.pxp-company-dashboard-candidates-bulk-actions-apply')
    .on('click', function() {
        var action = $('#pxp-company-dashboard-candidates-bulk-actions').val();
        var apps = [];
        var _self = $(this);

        $('.pxp-company-dashboard-check').each(function() {
            if ($(this).is(':checked')) {
                apps.push({
                    job_id      : $(this).attr('data-job-id'),
                    candidate_id: $(this).attr('data-candidate-id')
                });
            }
        });

        if (action == 'approve') {
            if (apps.length > 0) {
                _self.addClass('disabled');
                _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-text').hide();
                _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-loading').show();

                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: services_vars.ajaxurl,
                    data: {
                        'action'  : 'jobster_set_app_status',
                        'apps'    : apps,
                        'status'  : 'approved',
                        'security': $('#pxp-company-candidates-security').val()
                    },
                    success: function(data) {
                        if (data.set === true) {
                            $('.pxp-company-dashboard-check').each(function() {
                                if ($(this).is(':checked')) {
                                    $(this)
                                    .parent().parent()
                                    .find('.pxp-company-dashboard-job-status')
                                    .html(
                                        `<span class="badge rounded-pill bg-success">
                                            ${services_vars.approved_status}
                                        </span>`
                                    );
                                    $(this)[0].checked = false;
                                }
                            });
                        }

                        _self.removeClass('disabled');
                        _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-loading').hide();
                        _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-text').show();

                        $('#pxp-company-dashboard-candidates-bulk-actions').val('');
                        $('.pxp-company-dashboard-check-all-candidates')[0].checked = false;
                    },
                    error: function(errorThrown) {}
                });
            }
        } else if (action == 'reject') {
            if (apps.length > 0) {
                _self.addClass('disabled');
                _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-text').hide();
                _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-loading').show();

                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: services_vars.ajaxurl,
                    data: {
                        'action'  : 'jobster_set_app_status',
                        'apps'    : apps,
                        'status'  : 'rejected',
                        'security': $('#pxp-company-candidates-security').val()
                    },
                    success: function(data) {
                        if (data.set === true) {
                            $('.pxp-company-dashboard-check').each(function() {
                                if ($(this).is(':checked')) {
                                    $(this)
                                    .parent().parent()
                                    .find('.pxp-company-dashboard-job-status')
                                    .html(
                                        `<span class="badge rounded-pill bg-danger">
                                            ${services_vars.rejected_status}
                                        </span>`
                                    );
                                    $(this)[0].checked = false;
                                }
                            });
                        }

                        _self.removeClass('disabled');
                        _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-loading').hide();
                        _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-text').show();

                        $('#pxp-company-dashboard-candidates-bulk-actions').val('');
                        $('.pxp-company-dashboard-check-all-candidates')[0].checked = false;
                    },
                    error: function(errorThrown) {}
                });
            }
        } else if (action == 'delete') {
            if (apps.length > 0) {
                _self.addClass('disabled');
                _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-text').hide();
                _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-loading').show();

                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: services_vars.ajaxurl,
                    data: {
                        'action'  : 'jobster_delete_app',
                        'apps'    : apps,
                        'security': $('#pxp-company-candidates-security').val()
                    },
                    success: function(data) {
                        _self.removeClass('disabled');
                        _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-loading').hide();
                        _self.find('.pxp-company-dashboard-candidates-bulk-actions-apply-text').show();

                        document.location.href = services_vars.company_candidates_url;
                    },
                    error: function(errorThrown) {}
                });
            }
        }
    });

    // Manage company new password
    $('.pxp-company-save-password-btn').on('click', function() {
        var message;
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.pxp-company-save-password-btn-text').hide();
        _self.find('.pxp-company-save-password-btn-loading').show();
        $('.pxp-is-required').removeClass('is-invalid');

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'         : 'jobster_save_pass',
                'old_pass'       : $('#pxp-company-password-old').val(),
                'new_pass'       : $('#pxp-company-password-new').val(),
                'new_pass_repeat': $('#pxp-company-password-new-repeat').val(),
                'security'       : $('#pxp-password-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-company-save-password-btn-loading').hide();
                _self.find('.pxp-company-save-password-btn-text').show();

                if (data.save === true) {
                    message = showSuccessMessage(data.message);

                    $('.pxp-company-password-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');

                    $('#pxp-company-password-old').val('');
                    $('#pxp-company-password-new').val('');
                    $('#pxp-company-password-new-repeat').val('');
                } else {
                    if (data.field) {
                        var fields = data.field.split(',');

                        fields.forEach(field => {
                            if (field == 'old') {
                                $('#pxp-company-password-old')
                                .addClass('is-invalid');
                            } else if (field == 'new') {
                                $('#pxp-company-password-new')
                                .addClass('is-invalid');
                            } else if (field == 'new_r') {
                                $('#pxp-company-password-new-repeat')
                                .addClass('is-invalid');
                            }
                        });
                    }

                    message = showErrorMessage(data.message);

                    $('.pxp-company-password-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Company inbox - send message
    $('#pxp-company-dashboard-inbox-message-field').on('keydown', function(e) {
        if (e.keyCode === 13) {
            e.preventDefault();
            companyInboxSendMessage();
        }
    });
    $('.pxp-company-dashboard-inbox-send-btn').on('click', function(e) {
        e.preventDefault();
        companyInboxSendMessage();
    });
    function companyInboxSendMessage() {
        $('.pxp-company-dashboard-inbox-send-btn').addClass('disabled');
        $('.pxp-company-dashboard-inbox-send-btn-text').hide();
        $('.pxp-company-dashboard-inbox-send-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'         : 'jobster_contact_candidate',
                'user_id'        : $('#pxp-company-dashboard-inbox-user-id').val(),
                'candidate_id'   : $('#pxp-company-dashboard-inbox-candidate-id').val(),
                'company_id'     : $('#pxp-company-dashboard-inbox-company-id').val(),
                'name'           : $('#pxp-company-dashboard-inbox-company-name').val(),
                'email'          : $('#pxp-company-dashboard-inbox-company-email').val(),
                'candidate_email': $('#pxp-company-dashboard-inbox-candidate-email').val(),
                'message'        : $('#pxp-company-dashboard-inbox-message-field').val(),
                'security'       : $('#pxp-company-inbox-security').val()
            },
            success: function(data) {
                $('.pxp-company-dashboard-inbox-send-btn').removeClass('disabled');
                $('.pxp-company-dashboard-inbox-send-btn-loading').hide();
                $('.pxp-company-dashboard-inbox-send-btn-text').show();

                if (data.sent === true) {
                    var avatarHolder = $('.pxp-company-dashboard-inbox-avatar-holder').html();
                    var message = $('#pxp-company-dashboard-inbox-message-field').val();
                    var newMessageHTML = 
                        `<div class="pxp-dashboard-inbox-messages-item mt-4">
                            <div class="row justify-content-end">
                                <div class="col-7">
                                    <div class="pxp-dashboard-inbox-messages-item-header flex-row-reverse">
                                        ${avatarHolder}
                                        <div class="pxp-dashboard-inbox-messages-item-time pxp-text-light me-3">
                                            ${data.time}
                                        </div>
                                    </div>
                                    <div class="pxp-dashboard-inbox-messages-item-message mt-2 pxp-is-self">
                                        ${message}
                                    </div>
                                </div>
                            </div>
                        </div>`;

                    $('.pxp-dashboard-inbox-messages-content').append(newMessageHTML);
                    $('#pxp-company-dashboard-inbox-message-field').val('');

                    var inboxContainer = $('.pxp-dashboard-inbox-messages-content');
                    inboxContainer[0].scrollTop = inboxContainer[0].scrollHeight;
                }
            },
            error: function(errorThrown) {}
        });
    }

    // Company Dashboard - Delete Notification
    $('.pxp-company-dashboard-delete-notify-btn').on('click', function() {
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.fa').hide();
        _self.find('.pxp-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'    : 'jobster_delete_company_notify',
                'offset'    : _self.attr('data-offset'),
                'company_id': _self.attr('data-company-id'),
                'security'  : $('#pxp-company-notifications-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-btn-loading').hide();
                _self.find('.fa').show();

                if (data.deleted === true) {
                    document.location.href = services_vars.company_notifications_url;
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Set candidate notifications as read when click on bell icon
    $('.pxp-candidate-notifications > a').on('click', function() {
        var candidateId = $(this).attr('data-id');
        var _self = $(this);

        if (_self.find('.pxp-user-notifications-counter').length > 0) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'      : 'jobster_set_candidate_read_notifications',
                    'candidate_id': candidateId,
                    'security'    : $('#pxp-notifications-security').val()
                },
                success: function(data) {
                    if (data.set === true) {
                        _self.find('.pxp-user-notifications-counter').remove();
                        $('.badge.pxp-unread-notificatons').remove();
                        $('.pxp-dashboard-stats-card-info-number.pxp-is-notify').text('0');
                        _self.next('ul').find('li').removeClass('pxp-unread');
                    }
                },
                error: function(errorThrown) {}
            });
        }
    });

    // Candidate dashboard charts
    if ($('#pxp-candidate-dashboard-visitors-chart').length > 0) {
        var candidateVisitsChartElem = document
                                    .getElementById('pxp-candidate-dashboard-visitors-chart')
                                    .getContext('2d');

        var gradient = candidateVisitsChartElem.createLinearGradient(0, 250, 0, 0);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
        gradient.addColorStop(.5, 'rgba(0, 112, 201, 0.09)');
        gradient.addColorStop(1, 'rgba(0, 112, 201, 0.12)');

        var candidateVisitsChart = new Chart(candidateVisitsChartElem, {
            type: 'line',
            data: {
                labels: ['', '', '', '', '', '', ''],
                datasets: [{
                    label: services_vars.visitors,
                    data: [0, 0, 0, 0, 0, 0, 0],
                    borderWidth: 3,
                    borderColor: 'rgba(0, 112, 201, 1)',
                    pointBackgroundColor: 'rgba(255, 255, 255, 0)',
                    pointHoverBackgroundColor: 'rgba(255, 255, 255, 1)',
                    pointBorderColor: 'rgba(66, 133, 244, 0)',
                    pointHoverBorderColor: 'rgba(0, 112, 201, 1)',
                    pointBorderWidth: 10,
                    pointHoverBorderWidth: 3,
                    pointHitRadius: 20,
                    cubicInterpolationMode: 'monotone',
                    fill: true,
                    backgroundColor: gradient
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            fontColor: 'rgba(153, 153, 153, 1)',
                            maxTicksLimit: 7,
                            maxRotation: 0
                        },
                        gridLines: {
                            zeroLineColor: 'rgba(232, 232, 232, 1)',
                            drawOnChartArea: false,
                        },
                    }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            fontColor: 'rgba(153, 153, 153, 1)',
                            callback: function(value, index, values) {
                                if (Math.floor(value) === value) {
                                    return value;
                                }
                            }
                        },
                        gridLines: {
                            zeroLineColor: 'rgba(232, 232, 232, 0)',
                        },
                    }],
                },
                responsive: true,
                tooltips: {
                    backgroundColor: 'rgba(0, 39, 69, 1)',
                    cornerRadius: 7,
                    mode: 'index',
                    intersect: false,
                    displayColors: false,
                    xPadding: 10,
                    yPadding: 10,
                    titleFontColor: 'rgba(255, 255, 255, .7)',
                    bodyFontColor: 'rgba(255, 255, 255, 1)',
                    titleFontStyle: 'normal',
                    bodyFontStyle: 'bold',
                },
                legend: {
                    display: false,
                }
            }
        });
    }

    function getCandidateVisitorsByPeriod(period = '-7 days') {
        if ($('#pxp-candidate-dashboard-visitors-chart').length > 0) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'      : 'jobster_get_candidate_visitors',
                    'candidate_id': $('#pxp-candidate-id').val(),
                    'period'      : period,
                    'security'    : $('#pxp-charts-security').val()
                },
                success: function(data) {
                    if (data.getvisitors === true) {
                        var visitors_no = [];
                        var visitors_dates = [];
                        var percent;
                        var versus = {
                            '-7 days'   : services_vars.vs_7_days,
                            '-30 days'  : services_vars.vs_30_days,
                            '-60 days'  : services_vars.vs_60_days,
                            '-90 days'  : services_vars.vs_90_days,
                            '-12 months': services_vars.vs_12_months,
                        };

                        $.each(data.visitors, function(date, visitor) {
                            visitors_no.push(visitor);
                            visitors_dates.push(date);
                        });

                        candidateVisitsChart.data.labels = visitors_dates;
                        candidateVisitsChart.data.datasets[0].data = visitors_no;

                        candidateVisitsChart.update();

                        $('.pxp-candidate-dashboard-visitors-chart-percent')
                        .removeClass('text-success')
                        .removeClass('text-danger');
                        $('.pxp-candidate-dashboard-visitors-number-total')
                        .text(data.total_visitors);

                        if (data.total_visitors_prev == 0) {
                            percent = parseInt(data.total_visitors) * 100;
                        } else {
                            percent = (
                                (parseInt(data.total_visitors) - parseInt(data.total_visitors_prev)) * 100
                            ) / parseInt(data.total_visitors_prev);
                        }

                        if (percent >= 0) {
                            $('.pxp-candidate-dashboard-visitors-chart-percent')
                            .addClass('text-success')
                            .html(`<span class="fa fa-long-arrow-up"></span> ${Math.abs(percent.toFixed(1))}%`);
                        } else {
                            $('.pxp-candidate-dashboard-visitors-chart-percent')
                            .addClass('text-danger')
                            .html(`<span class="fa fa-long-arrow-down"></span> ${Math.abs(percent.toFixed(1))}%`);
                        }

                        $('.pxp-candidate-dashboard-visitors-vs').html(versus[period]);
                    }
                },
                error: function(errorThrown) {}
            });
        }
    }

    getCandidateVisitorsByPeriod();

    $('#pxp-candidate-visitors-period').on('change', function() {
        getCandidateVisitorsByPeriod($(this).val());
    });

    if ($('#pxp-candidate-dashboard-apps-chart').length > 0) {
        var candidateAppsChartElem =  document
                                    .getElementById('pxp-candidate-dashboard-apps-chart')
                                    .getContext('2d');

        var gradient = candidateAppsChartElem.createLinearGradient(0, 250, 0, 0);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
        gradient.addColorStop(.5, 'rgba(255, 168, 35, 0.09)');
        gradient.addColorStop(1, 'rgba(255, 168, 35, 0.12)');

        var candidateAppsChart = new Chart(candidateAppsChartElem, {
            type: 'line',
            data: {
                labels: ['', '', '', '', '', '', ''],
                datasets: [{
                    label: services_vars.applications,
                    data: [0, 0, 0, 0, 0, 0, 0],
                    borderWidth: 3,
                    borderColor: 'rgba(255, 168, 35, 1)',
                    pointBackgroundColor: 'rgba(255, 255, 255, 0)',
                    pointHoverBackgroundColor: 'rgba(255, 255, 255, 1)',
                    pointBorderColor: 'rgba(66, 133, 244, 0)',
                    pointHoverBorderColor: 'rgba(255, 168, 35, 1)',
                    pointBorderWidth: 10,
                    pointHoverBorderWidth: 3,
                    pointHitRadius: 20,
                    cubicInterpolationMode: 'monotone',
                    fill: true,
                    backgroundColor: gradient
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            fontColor: 'rgba(153, 153, 153, 1)',
                            maxTicksLimit: 7,
                            maxRotation: 0
                        },
                        gridLines: {
                            zeroLineColor: 'rgba(232, 232, 232, 1)',
                            drawOnChartArea: false,
                        },
                    }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            fontColor: 'rgba(153, 153, 153, 1)',
                            callback: function(value, index, values) {
                                if (Math.floor(value) === value) {
                                    return value;
                                }
                            }
                        },
                        gridLines: {
                            zeroLineColor: 'rgba(232, 232, 232, 0)',
                        },
                    }],
                },
                responsive: true,
                tooltips: {
                    backgroundColor: 'rgba(0, 39, 69, 1)',
                    cornerRadius: 7,
                    mode: 'index',
                    intersect: false,
                    displayColors: false,
                    xPadding: 10,
                    yPadding: 10,
                    titleFontColor: 'rgba(255, 255, 255, .7)',
                    bodyFontColor: 'rgba(255, 255, 255, 1)',
                    titleFontStyle: 'normal',
                    bodyFontStyle: 'bold',
                },
                legend: {
                    display: false,
                }
            }
        });
    }

    function getCandidateAppsByPeriod(period = '-7 days') {
        if ($('#pxp-candidate-dashboard-apps-chart').length > 0) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: services_vars.ajaxurl,
                data: {
                    'action'      : 'jobster_get_candidate_jobs_apps',
                    'candidate_id': $('#pxp-candidate-id').val(),
                    'period'      : period,
                    'security'    : $('#pxp-charts-security').val()
                },
                success: function(data) {
                    if (data.getapps === true) {
                        var apps_no = [];
                        var apps_dates = [];
                        var percent;
                        var versus = {
                            '-7 days'   : services_vars.vs_7_days,
                            '-30 days'  : services_vars.vs_30_days,
                            '-60 days'  : services_vars.vs_60_days,
                            '-90 days'  : services_vars.vs_90_days,
                            '-12 months': services_vars.vs_12_months,
                        };

                        $.each(data.apps, function(date, app) {
                            apps_no.push(app);
                            apps_dates.push(date);
                        });

                        candidateAppsChart.data.labels = apps_dates;
                        candidateAppsChart.data.datasets[0].data = apps_no;

                        candidateAppsChart.update();

                        $('.pxp-candidate-dashboard-apps-chart-percent')
                        .removeClass('text-success')
                        .removeClass('text-danger');
                        $('.pxp-candidate-dashboard-apps-number-total')
                        .text(data.total_apps);

                        if (data.total_apps_prev == 0) {
                            percent = parseInt(data.total_apps) * 100;
                        } else {
                            percent = (
                                (parseInt(data.total_apps) - parseInt(data.total_apps_prev)) * 100
                            ) / parseInt(data.total_apps_prev);
                        }

                        if (percent >= 0) {
                            $('.pxp-candidate-dashboard-apps-chart-percent')
                            .addClass('text-success')
                            .html(`<span class="fa fa-long-arrow-up"></span> ${Math.abs(percent.toFixed(1))}%`);
                        } else {
                            $('.pxp-candidate-dashboard-apps-chart-percent')
                            .addClass('text-danger')
                            .html(`<span class="fa fa-long-arrow-down"></span> ${Math.abs(percent.toFixed(1))}%`);
                        }

                        $('.pxp-candidate-dashboard-apps-vs').html(versus[period]);
                    }
                },
                error: function(errorThrown) {}
            });
        }
    }

    getCandidateAppsByPeriod();

    $('#pxp-candidate-apps-period').on('change', function() {
        getCandidateAppsByPeriod($(this).val());
    });

    // Manage add skill to candidate dashboard profile
    $('.pxp-candidate-dashboard-add-skill-btn').on('click', function() {
        var newSkill = $('#pxp-candidate-profile-skills').val();

        if (newSkill != '') {
            $('.pxp-candidate-dashboard-skills ul').append(
                `<li data-id="">
                    ${newSkill}
                    <span class="fa fa-trash-o"></span>
                </li>`
            );
            $('#pxp-candidate-profile-skills').val('');
        }

        $('.pxp-candidate-dashboard-skills ul li span').on('click', function() {
            $(this).parent().remove();
        });
    });

    $('#pxp-candidate-profile-skills').keydown(function(e) {
        if (e.keyCode === 13) {
            e.preventDefault();

            var newSkill = $('#pxp-candidate-profile-skills').val();

            if (newSkill != '') {
                $('.pxp-candidate-dashboard-skills ul').append(
                    `<li data-id="">
                        ${newSkill}
                        <span class="fa fa-trash-o"></span>
                    </li>`
                );
                $('#pxp-candidate-profile-skills').val('');
            }
        }

        $('.pxp-candidate-dashboard-skills ul li span').on('click', function() {
            $(this).parent().remove();
        });
    });

    // Manage delete skill from candidate dashboard profile
    $('.pxp-candidate-dashboard-skills ul li span').on('click', function() {
        $(this).parent().remove();
    });

    // Manage candidate dashboard work experience
    if ($('#pxp-candidate-dashboard-work').length > 0) {
        var data = {
            'works' : []
        }
        var work = '';
        var workRaw = $('#pxp-candidate-dashboard-work').val();

        if (workRaw != '') {
            work = jsonParser(decodeURIComponent(workRaw.replace(/\+/g, ' ')));

            if (work !== null) {
                data = work;
            }
        }

        $('.pxp-candidate-dashboard-add-work-btn').on('click', function(event) {
            event.preventDefault();

            $(this).hide();
            $('.pxp-candidate-dashboard-work-form').removeClass('d-none');
        });

        $('.pxp-candidate-dashboard-ok-work-btn').on('click', function(event) {
            event.preventDefault();

            var title       = $('#pxp-candidate-dashboard-work-title').val();
            var company     = $('#pxp-candidate-dashboard-work-company').val();
            var period      = $('#pxp-candidate-dashboard-work-time').val();
            var description = $('#pxp-candidate-dashboard-work-about').val();

            $('.pxp-candidate-dashboard-work-form .pxp-is-required')
            .removeClass('is-invalid');

            var error = false;
            if (title == '') {
                $('#pxp-candidate-dashboard-work-title').addClass('is-invalid');
                error = true;
            }
            if (company == '') {
                $('#pxp-candidate-dashboard-work-company').addClass('is-invalid');
                error = true;
            }
            if (period == '') {
                $('#pxp-candidate-dashboard-work-time').addClass('is-invalid');
                error = true;
            }
            if (description == '') {
                $('#pxp-candidate-dashboard-work-about').addClass('is-invalid');
                error = true;
            }

            if (error === false) {
                data.works.push({
                    'title'      : title,
                    'company'    : company,
                    'period'     : period,
                    'description': description
                });

                $('#pxp-candidate-dashboard-work').val(
                    fixedEncodeURIComponent(JSON.stringify(data))
                );

                $('.pxp-candidate-dashboard-work-list tbody').append(
                    `<tr>
                        <td style="width: 30%;">
                            <div class="pxp-candidate-dashboard-work-cell-title">
                                ${title}
                            </div>
                        </td>
                        <td style="width: 25%;">
                            <div class="pxp-candidate-dashboard-work-cell-company">
                                ${company}
                            </div>
                        </td>
                        <td style="width: 25%;">
                            <div class="pxp-candidate-dashboard-work-cell-time">
                                ${period}
                            </div>
                        </td>
                        <td>
                            <div class="pxp-dashboard-table-options">
                                <ul 
                                    class="list-unstyled" 
                                    data-title="${title}" 
                                    data-company="${company}" 
                                    data-period="${period}" 
                                    data-description="${description}"
                                >
                                    <li>
                                        <button 
                                            class="pxp-candidate-dashboard-edit-new-work-btn" 
                                            title="${services_vars.edit}"
                                        >
                                            <span class="fa fa-pencil"></span>
                                        </button>
                                    </li>
                                    <li>
                                        <button 
                                            class="pxp-candidate-dashboard-delete-new-work-btn" 
                                            title="${services_vars.delete}"
                                        >
                                            <span class="fa fa-trash-o"></span>
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>`
                );

                $('#pxp-candidate-dashboard-work-title').val('');
                $('#pxp-candidate-dashboard-work-company').val('');
                $('#pxp-candidate-dashboard-work-time').val('');
                $('#pxp-candidate-dashboard-work-about').val('');

                $('.pxp-candidate-dashboard-work-form').addClass('d-none');
                $('.pxp-candidate-dashboard-add-work-btn').show();

                $('.pxp-candidate-dashboard-edit-new-work-btn')
                .unbind('click')
                .on('click', function(event) {
                    event.preventDefault();
                    editCandidateWorkExperience($(this));
                });
                $('.pxp-candidate-dashboard-delete-new-work-btn')
                .unbind('click')
                .on('click', function(event) {
                    event.preventDefault();
                    delCandidateWorkExperience($(this));
                });
            }
        });

        $('.pxp-candidate-dashboard-cancel-work-btn').on('click', function(event) {
            event.preventDefault();

            $('#pxp-candidate-dashboard-work-title').val('');
            $('#pxp-candidate-dashboard-work-company').val('');
            $('#pxp-candidate-dashboard-work-time').val('');
            $('#pxp-candidate-dashboard-work-about').val('');

            $('.pxp-candidate-dashboard-work-form').addClass('d-none');
            $('.pxp-candidate-dashboard-add-work-btn').show();
        });

        $('.pxp-candidate-dashboard-edit-work-btn').on('click', function(event) {
            event.preventDefault();
            editCandidateWorkExperience($(this));
        });
        $('.pxp-candidate-dashboard-delete-work-btn').on('click', function(event) {
            event.preventDefault();
            delCandidateWorkExperience($(this));
        });
    }

    function delCandidateWorkExperience(btn) {
        btn.parent().parent().parent().parent().parent().remove();

        data.works = [];

        $('.pxp-candidate-dashboard-work-list .pxp-dashboard-table-options')
        .each(function(index, el) {
            var elem = $(this).find('ul');

            data.works.push({
                'title'      : elem.attr('data-title'),
                'company'    : elem.attr('data-company'),
                'period'     : elem.attr('data-period'),
                'description': elem.attr('data-description')
            });
        });

        $('#pxp-candidate-dashboard-work').val(
            fixedEncodeURIComponent(JSON.stringify(data))
        );
    }

    function editCandidateWorkExperience(btn) {
        var dataElem = btn.parent().parent();

        var editTitle       = dataElem.attr('data-title');
        var editCompany     = dataElem.attr('data-company');
        var editPeriod      = dataElem.attr('data-period');
        var editDescription = dataElem.attr('data-description');

        $('.pxp-candidate-dashboard-edit-work-form').append(
            `<div class="row mt-3 mt-lg-4">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label 
                            for="pxp-candidate-dashboard-edit-work-title" 
                            class="form-label"
                        >
                            ${services_vars.job_title}
                            <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="pxp-candidate-dashboard-edit-work-title" 
                            class="form-control pxp-is-required" 
                            placeholder="${services_vars.job_title_placeholder}" 
                            value="${editTitle}"
                        >
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label 
                            for="pxp-candidate-dashboard-edit-work-company" 
                            class="form-label"
                        >
                            ${services_vars.company}
                            <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="pxp-candidate-dashboard-edit-work-company" 
                            class="form-control pxp-is-required" 
                            placeholder="${services_vars.company_placeholder}" 
                            value="${editCompany}"
                        >
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label 
                            for="pxp-candidate-dashboard-edit-work-time" 
                            class="form-label"
                        >
                            ${services_vars.time_period}
                            <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="pxp-candidate-dashboard-edit-work-time" 
                            class="form-control pxp-is-required" 
                            placeholder="E.g. 2005 - 2013" 
                            value="${editPeriod}"
                        >
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label 
                    for="pxp-candidate-dashboard-edit-work-about" 
                    class="form-label"
                >
                    ${services_vars.description}
                    <span class="text-danger">*</span>
                </label>
                <textarea 
                    class="form-control pxp-smaller pxp-is-required" 
                    id="pxp-candidate-dashboard-edit-work-about" 
                    placeholder="${services_vars.type_description}"
                >${editDescription}</textarea>
            </div>

            <a 
                href="javascript:void(0);" 
                class="btn rounded-pill pxp-subsection-cta pxp-candidate-dashboard-ok-edit-work-btn"
            >
                ${services_vars.update}
            </a>
            <a 
                href="javascript:void(0);" 
                class="btn rounded-pill pxp-subsection-cta-o ms-e pxp-candidate-dashboard-cancel-edit-work-btn"
            >
                ${services_vars.cancel}
            </a>`
        );

        $('.pxp-candidate-dashboard-edit-work-btn').hide();
        $('.pxp-candidate-dashboard-delete-work-btn').hide();
        $('.pxp-candidate-dashboard-edit-new-work-btn').hide();
        $('.pxp-candidate-dashboard-delete-new-work-btn').hide();
        $('.pxp-candidate-dashboard-work-form').addClass('d-none');
        $('.pxp-candidate-dashboard-add-work-btn').hide();

        $('.pxp-candidate-dashboard-edit-work-form')[0].scrollIntoView();

        $('.pxp-candidate-dashboard-ok-edit-work-btn').on('click', function() {
            var eTitle       = $('#pxp-candidate-dashboard-edit-work-title').val();
            var eCompany     = $('#pxp-candidate-dashboard-edit-work-company').val();
            var ePeriod      = $('#pxp-candidate-dashboard-edit-work-time').val();
            var eDescription = $('#pxp-candidate-dashboard-edit-work-about').val();

            dataElem.attr({
                'data-title'      : eTitle,
                'data-company'    : eCompany,
                'data-period'     : ePeriod,
                'data-description': eDescription
            });

            var dataElemRow = dataElem.parent().parent().parent();
            dataElemRow.find('.pxp-candidate-dashboard-work-cell-title').text(eTitle);
            dataElemRow.find('.pxp-candidate-dashboard-work-cell-company').text(eCompany);
            dataElemRow.find('.pxp-candidate-dashboard-work-cell-time').text(ePeriod);

            $('.pxp-candidate-dashboard-edit-work-form').empty();
            $('.pxp-candidate-dashboard-edit-work-btn').show();
            $('.pxp-candidate-dashboard-delete-work-btn').show();
            $('.pxp-candidate-dashboard-edit-new-work-btn').show();
            $('.pxp-candidate-dashboard-delete-new-work-btn').show();
            $('.pxp-candidate-dashboard-add-work-btn').show();

            data.works = [];

            $('.pxp-candidate-dashboard-work-list .pxp-dashboard-table-options')
            .each(function(index, el) {
                var elem = $(this).find('ul');

                data.works.push({
                    'title'      : elem.attr('data-title'),
                    'company'    : elem.attr('data-company'),
                    'period'     : elem.attr('data-period'),
                    'description': elem.attr('data-description')
                });
            });

            $('#pxp-candidate-dashboard-work').val(
                fixedEncodeURIComponent(JSON.stringify(data))
            );

            $('.pxp-candidate-dashboard-work-list')[0].scrollIntoView();
        });

        $('.pxp-candidate-dashboard-cancel-edit-work-btn').on('click', function() {
            $('.pxp-candidate-dashboard-edit-work-form').empty();
            $('.pxp-candidate-dashboard-edit-work-btn').show();
            $('.pxp-candidate-dashboard-delete-work-btn').show();
            $('.pxp-candidate-dashboard-edit-new-work-btn').show();
            $('.pxp-candidate-dashboard-delete-new-work-btn').show();
            $('.pxp-candidate-dashboard-add-work-btn').show();

            $('.pxp-candidate-dashboard-work-list')[0].scrollIntoView();
        });
    };

    // Manage candidate dashboard education
    if ($('#pxp-candidate-dashboard-edu').length > 0) {
        var dataEdu = {
            'edus' : []
        }
        var edu = '';
        var eduRaw = $('#pxp-candidate-dashboard-edu').val();

        if (eduRaw != '') {
            edu = jsonParser(decodeURIComponent(eduRaw.replace(/\+/g, ' ')));

            if (edu !== null) {
                dataEdu = edu;
            }
        }

        $('.pxp-candidate-dashboard-add-edu-btn').on('click', function(event) {
            event.preventDefault();

            $(this).hide();
            $('.pxp-candidate-dashboard-edu-form').removeClass('d-none');
        });

        $('.pxp-candidate-dashboard-ok-edu-btn').on('click', function(event) {
            event.preventDefault();

            var title       = $('#pxp-candidate-dashboard-edu-title').val();
            var school      = $('#pxp-candidate-dashboard-edu-school').val();
            var period      = $('#pxp-candidate-dashboard-edu-time').val();
            var description = $('#pxp-candidate-dashboard-edu-about').val();

            $('.pxp-candidate-dashboard-edu-form .pxp-is-required')
            .removeClass('is-invalid');

            var error = false;
            if (title == '') {
                $('#pxp-candidate-dashboard-edu-title').addClass('is-invalid');
                error = true;
            }
            if (school == '') {
                $('#pxp-candidate-dashboard-edu-school').addClass('is-invalid');
                error = true;
            }
            if (period == '') {
                $('#pxp-candidate-dashboard-edu-time').addClass('is-invalid');
                error = true;
            }
            if (description == '') {
                $('#pxp-candidate-dashboard-edu-about').addClass('is-invalid');
                error = true;
            }

            if (error === false) {
                dataEdu.edus.push({
                    'title'      : title,
                    'school'     : school,
                    'period'     : period,
                    'description': description
                });

                $('#pxp-candidate-dashboard-edu').val(
                    fixedEncodeURIComponent(JSON.stringify(dataEdu))
                );

                $('.pxp-candidate-dashboard-edu-list tbody').append(
                    `<tr>
                        <td style="width: 30%;">
                            <div class="pxp-candidate-dashboard-edu-cell-title">
                                ${title}
                            </div>
                        </td>
                        <td style="width: 25%;">
                            <div class="pxp-candidate-dashboard-edu-cell-school">
                                ${school}
                            </div>
                        </td>
                        <td style="width: 25%;">
                            <div class="pxp-candidate-dashboard-edu-cell-time">
                                ${period}
                            </div>
                        </td>
                        <td>
                            <div class="pxp-dashboard-table-options">
                                <ul 
                                    class="list-unstyled" 
                                    data-title="${title}" 
                                    data-school="${school}" 
                                    data-period="${period}" 
                                    data-description="${description}"
                                >
                                    <li>
                                        <button 
                                            class="pxp-candidate-dashboard-edit-new-edu-btn" 
                                            title="${services_vars.edit}"
                                        >
                                            <span class="fa fa-pencil"></span>
                                        </button>
                                    </li>
                                    <li>
                                        <button 
                                            class="pxp-candidate-dashboard-delete-new-edu-btn" 
                                            title="${services_vars.delete}"
                                        >
                                            <span class="fa fa-trash-o"></span>
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>`
                );

                $('#pxp-candidate-dashboard-edu-title').val('');
                $('#pxp-candidate-dashboard-edu-school').val('');
                $('#pxp-candidate-dashboard-edu-time').val('');
                $('#pxp-candidate-dashboard-edu-about').val('');

                $('.pxp-candidate-dashboard-edu-form').addClass('d-none');
                $('.pxp-candidate-dashboard-add-edu-btn').show();

                $('.pxp-candidate-dashboard-edit-new-edu-btn')
                .unbind('click')
                .on('click', function(event) {
                    event.preventDefault();
                    editCandidateEducation($(this));
                });
                $('.pxp-candidate-dashboard-delete-new-edu-btn')
                .unbind('click')
                .on('click', function(event) {
                    event.preventDefault();
                    delCandidateEducation($(this));
                });
            }
        });

        $('.pxp-candidate-dashboard-cancel-edu-btn').on('click', function(event) {
            event.preventDefault();

            $('#pxp-candidate-dashboard-edu-title').val('');
            $('#pxp-candidate-dashboard-edu-school').val('');
            $('#pxp-candidate-dashboard-edu-time').val('');
            $('#pxp-candidate-dashboard-edu-about').val('');

            $('.pxp-candidate-dashboard-edu-form').addClass('d-none');
            $('.pxp-candidate-dashboard-add-edu-btn').show();
        });

        $('.pxp-candidate-dashboard-edit-edu-btn').on('click', function(event) {
            event.preventDefault();
            editCandidateEducation($(this));
        });
        $('.pxp-candidate-dashboard-delete-edu-btn').on('click', function(event) {
            event.preventDefault();
            delCandidateEducation($(this));
        });
    }

    function delCandidateEducation(btn) {
        btn.parent().parent().parent().parent().parent().remove();

        dataEdu.edus = [];

        $('.pxp-candidate-dashboard-edu-list .pxp-dashboard-table-options')
        .each(function(index, el) {
            var elem = $(this).find('ul');

            data.works.push({
                'title'      : elem.attr('data-title'),
                'school'     : elem.attr('data-school'),
                'period'     : elem.attr('data-period'),
                'description': elem.attr('data-description')
            });
        });

        $('#pxp-candidate-dashboard-edu').val(
            fixedEncodeURIComponent(JSON.stringify(data))
        );
    }

    function editCandidateEducation(btn) {
        var dataElem = btn.parent().parent();

        var editTitle       = dataElem.attr('data-title');
        var editSchool      = dataElem.attr('data-school');
        var editPeriod      = dataElem.attr('data-period');
        var editDescription = dataElem.attr('data-description');

        $('.pxp-candidate-dashboard-edit-edu-form').append(
            `<div class="row mt-3 mt-lg-4">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label 
                            for="pxp-candidate-dashboard-edit-edu-title" 
                            class="form-label"
                        >
                            ${services_vars.edu_title}
                            <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="pxp-candidate-dashboard-edit-edu-title" 
                            class="form-control pxp-is-required" 
                            placeholder="${services_vars.edu_title_placeholder}" 
                            value="${editTitle}"
                        >
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label 
                            for="pxp-candidate-dashboard-edit-edu-school" 
                            class="form-label"
                        >
                            ${services_vars.edu_school}
                            <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="pxp-candidate-dashboard-edit-edu-school" 
                            class="form-control pxp-is-required" 
                            placeholder="${services_vars.edu_school_placeholder}" 
                            value="${editSchool}"
                        >
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label 
                            for="pxp-candidate-dashboard-edit-edu-time" 
                            class="form-label"
                        >
                            ${services_vars.time_period}
                            <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="pxp-candidate-dashboard-edit-edu-time" 
                            class="form-control pxp-is-required" 
                            placeholder="E.g. 2005 - 2013" 
                            value="${editPeriod}"
                        >
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label 
                    for="pxp-candidate-dashboard-edit-edu-about" 
                    class="form-label"
                >
                    ${services_vars.description}
                    <span class="text-danger">*</span>
                </label>
                <textarea 
                    class="form-control pxp-smaller pxp-is-required" 
                    id="pxp-candidate-dashboard-edit-edu-about" 
                    placeholder="${services_vars.type_description}"
                >${editDescription}</textarea>
            </div>

            <a 
                href="javascript:void(0);" 
                class="btn rounded-pill pxp-subsection-cta pxp-candidate-dashboard-ok-edit-edu-btn"
            >
                ${services_vars.update}
            </a>
            <a 
                href="javascript:void(0);" 
                class="btn rounded-pill pxp-subsection-cta-o ms-e pxp-candidate-dashboard-cancel-edit-edu-btn"
            >
                ${services_vars.cancel}
            </a>`
        );

        $('.pxp-candidate-dashboard-edit-edu-btn').hide();
        $('.pxp-candidate-dashboard-delete-edu-btn').hide();
        $('.pxp-candidate-dashboard-edit-new-edu-btn').hide();
        $('.pxp-candidate-dashboard-delete-new-edu-btn').hide();
        $('.pxp-candidate-dashboard-edu-form').addClass('d-none');
        $('.pxp-candidate-dashboard-add-edu-btn').hide();

        $('.pxp-candidate-dashboard-edit-edu-form')[0].scrollIntoView();

        $('.pxp-candidate-dashboard-ok-edit-edu-btn').on('click', function() {
            var eTitle       = $('#pxp-candidate-dashboard-edit-edu-title').val();
            var eSchool      = $('#pxp-candidate-dashboard-edit-edu-school').val();
            var ePeriod      = $('#pxp-candidate-dashboard-edit-edu-time').val();
            var eDescription = $('#pxp-candidate-dashboard-edit-edu-about').val();

            dataElem.attr({
                'data-title'      : eTitle,
                'data-school'     : eSchool,
                'data-period'     : ePeriod,
                'data-description': eDescription
            });

            var dataElemRow = dataElem.parent().parent().parent();
            dataElemRow.find('.pxp-candidate-dashboard-edu-cell-title').text(eTitle);
            dataElemRow.find('.pxp-candidate-dashboard-edu-cell-school').text(eSchool);
            dataElemRow.find('.pxp-candidate-dashboard-edu-cell-time').text(ePeriod);

            $('.pxp-candidate-dashboard-edit-edu-form').empty();
            $('.pxp-candidate-dashboard-edit-edu-btn').show();
            $('.pxp-candidate-dashboard-delete-edu-btn').show();
            $('.pxp-candidate-dashboard-edit-new-edu-btn').show();
            $('.pxp-candidate-dashboard-delete-new-edu-btn').show();
            $('.pxp-candidate-dashboard-add-edu-btn').show();

            dataEdu.edus = [];

            $('.pxp-candidate-dashboard-edu-list .pxp-dashboard-table-options')
            .each(function(index, el) {
                var elem = $(this).find('ul');

                dataEdu.edus.push({
                    'title'      : elem.attr('data-title'),
                    'school'     : elem.attr('data-school'),
                    'period'     : elem.attr('data-period'),
                    'description': elem.attr('data-description')
                });
            });

            $('#pxp-candidate-dashboard-edu').val(
                fixedEncodeURIComponent(JSON.stringify(dataEdu))
            );

            $('.pxp-candidate-dashboard-edu-list')[0].scrollIntoView();
        });

        $('.pxp-candidate-dashboard-cancel-edit-edu-btn').on('click', function() {
            $('.pxp-candidate-dashboard-edit-edu-form').empty();
            $('.pxp-candidate-dashboard-edit-edu-btn').show();
            $('.pxp-candidate-dashboard-delete-edu-btn').show();
            $('.pxp-candidate-dashboard-edit-new-edu-btn').show();
            $('.pxp-candidate-dashboard-delete-new-edu-btn').show();
            $('.pxp-candidate-dashboard-add-edu-btn').show();

            $('.pxp-candidate-dashboard-edu-list')[0].scrollIntoView();
        });
    };

    // Manage update candidate profile
    $('.pxp-candidate-profile-update-btn').on('click', function() {
        var message;
        $(this).addClass('disabled');
        $('.pxp-candidate-profile-update-btn-text').hide();
        $('.pxp-candidate-profile-update-btn-loading').show();
        $('.pxp-is-required').removeClass('is-invalid');

        var skills = [];
        $('.pxp-candidate-dashboard-skills ul li').each(function() {
            skills.push({
                'id': $(this).attr('data-id'),
                'name': $(this).text().trim()
            });
        });

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'      : 'jobster_update_candidate_profile',
                'candidate_id': $('#pxp-candidate-profile-id').val(),
                'name'        : $('#pxp-candidate-profile-name').val(),
                'email'       : $('#pxp-candidate-profile-email').val(),
                'phone'       : $('#pxp-candidate-profile-phone').val(),
                'title'       : $('#pxp-candidate-profile-title').val(),
                'cover'       : $('#pxp-dashboard-cover').val(),
                'logo'        : $('#pxp-dashboard-logo').val(),
                'about'       : getTinymceContent('pxp-candidate-profile-about'),
                'industry'    : $('#pxp-candidate-profile-industry').val(),
                'location'    : $('#pxp-candidate-profile-location').val(),
                'skills'      : fixedEncodeURIComponent(JSON.stringify(skills)),
                'work'        : $('#pxp-candidate-dashboard-work').val(),
                'education'   : $('#pxp-candidate-dashboard-edu').val(),
                'cv'          : $('#pxp-dashboard-cv').val(),
                'security'    : $('#pxp-candidate-profile-security').val()
            },
            success: function(data) {
                $('.pxp-candidate-profile-update-btn').removeClass('disabled');
                $('.pxp-candidate-profile-update-btn-loading').hide();
                $('.pxp-candidate-profile-update-btn-text').show();

                if (data.update === true) {
                    document.location.href = services_vars.candidate_profile_url;
                } else {
                    if (data.field) {
                        $(`#${data.field}`).addClass('is-invalid');
                    }

                    message = showErrorMessage(data.message);

                    $('.pxp-candidate-profile-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Candidate Dashboard - Delete Application
    $('.pxp-candidate-dashboard-delete-app-btn').on('click', function() {
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.fa').hide();
        _self.find('.pxp-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'      : 'jobster_delete_app',
                'apps'        : [{
                    'job_id'      : _self.attr('data-job-id'),
                    'candidate_id': _self.attr('data-candidate-id')
                }],
                'security'    : $('#pxp-candidate-apps-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-btn-loading').hide();
                _self.find('.fa').show();

                if (data.deleted === true) {
                    document.location.href = services_vars.candidate_apps_url;
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Manage candidate applications - bulk actions
    $('.pxp-candidate-dashboard-check-all-apps').on('change', function() {
        let checks = document.querySelectorAll('.pxp-candidate-dashboard-check');

        if ($(this).is(':checked')) {
            checks.forEach(elem => {
                elem.checked = true;
            });
        } else {
            checks.forEach(elem => {
                elem.checked = false;
            });
        }
    });
    $('#pxp-candidate-dashboard-apps-bulk-actions')
    .on('change', function() {
        if ($(this).val() == 'delete') {
            $('.pxp-candidate-dashboard-apps-bulk-actions-apply')
            .removeClass('disabled');
        } else {
            $('.pxp-candidate-dashboard-apps-bulk-actions-apply')
            .addClass('disabled');
        }
    });
    $('.pxp-candidate-dashboard-apps-bulk-actions-apply')
    .on('click', function() {
        var action = $('#pxp-candidate-dashboard-apps-bulk-actions').val();
        var apps = [];
        var _self = $(this);

        $('.pxp-candidate-dashboard-check').each(function() {
            if ($(this).is(':checked')) {
                apps.push({
                    job_id      : $(this).attr('data-job-id'),
                    candidate_id: $(this).attr('data-candidate-id')
                });
            }
        });

        if (action == 'delete') {
            if (apps.length > 0) {
                _self.addClass('disabled');
                _self.find('.pxp-candidate-dashboard-apps-bulk-actions-apply-text').hide();
                _self.find('.pxp-candidate-dashboard-apps-bulk-actions-apply-loading').show();

                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: services_vars.ajaxurl,
                    data: {
                        'action'  : 'jobster_delete_app',
                        'apps'    : apps,
                        'security': $('#pxp-candidate-apps-security').val()
                    },
                    success: function(data) {
                        _self.removeClass('disabled');
                        _self.find('.pxp-candidate-dashboard-apps-bulk-actions-apply-loading').hide();
                        _self.find('.pxp-candidate-dashboard-apps-bulk-actions-apply-text').show();

                        document.location.href = services_vars.candidate_apps_url;
                    },
                    error: function(errorThrown) {}
                });
            }
        }
    });

    // Candidate Dashboard - Delete Favourite Job
    $('.pxp-candidate-dashboard-delete-fav-btn').on('click', function() {
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.fa').hide();
        _self.find('.pxp-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'  : 'jobster_candidate_remove_fav',
                'job_ids' : [_self.attr('data-job-id')],
                'security': $('#pxp-candidate-favs-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-btn-loading').hide();
                _self.find('.fa').show();

                if (data.removed === true) {
                    document.location.href = services_vars.candidate_favs_url;
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Manage candidate favs - bulk actions
    $('.pxp-candidate-dashboard-check-all-favs').on('change', function() {
        let checks = document.querySelectorAll('.pxp-candidate-dashboard-check');

        if ($(this).is(':checked')) {
            checks.forEach(elem => {
                elem.checked = true;
            });
        } else {
            checks.forEach(elem => {
                elem.checked = false;
            });
        }
    });
    $('#pxp-candidate-dashboard-favs-bulk-actions')
    .on('change', function() {
        if ($(this).val() == 'delete') {
            $('.pxp-candidate-dashboard-favs-bulk-actions-apply')
            .removeClass('disabled');
        } else {
            $('.pxp-candidate-dashboard-favs-bulk-actions-apply')
            .addClass('disabled');
        }
    });
    $('.pxp-candidate-dashboard-favs-bulk-actions-apply')
    .on('click', function() {
        var action = $('#pxp-candidate-dashboard-favs-bulk-actions').val();
        var job_ids = [];
        var _self = $(this);

        $('.pxp-candidate-dashboard-check').each(function() {
            if ($(this).is(':checked')) {
                job_ids.push($(this).attr('data-job-id'));
            }
        });

        if (action == 'delete') {
            if (job_ids.length > 0) {
                _self.addClass('disabled');
                _self.find('.pxp-candidate-dashboard-favs-bulk-actions-apply-text').hide();
                _self.find('.pxp-candidate-dashboard-favs-bulk-actions-apply-loading').show();

                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: services_vars.ajaxurl,
                    data: {
                        'action'  : 'jobster_candidate_remove_fav',
                        'job_ids' : job_ids,
                        'security': $('#pxp-candidate-favs-security').val()
                    },
                    success: function(data) {
                        _self.removeClass('disabled');
                        _self.find('.pxp-candidate-dashboard-favs-bulk-actions-apply-loading').hide();
                        _self.find('.pxp-candidate-dashboard-favs-bulk-actions-apply-text').show();

                        document.location.href = services_vars.candidate_favs_url;
                    },
                    error: function(errorThrown) {}
                });
            }
        }
    });

    // Manage candidate new password
    $('.pxp-candidate-save-password-btn').on('click', function() {
        var message;
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.pxp-candidate-save-password-btn-text').hide();
        _self.find('.pxp-candidate-save-password-btn-loading').show();
        $('.pxp-is-required').removeClass('is-invalid');

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'         : 'jobster_save_pass',
                'old_pass'       : $('#pxp-candidate-password-old').val(),
                'new_pass'       : $('#pxp-candidate-password-new').val(),
                'new_pass_repeat': $('#pxp-candidate-password-new-repeat').val(),
                'security'       : $('#pxp-password-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-candidate-save-password-btn-loading').hide();
                _self.find('.pxp-candidate-save-password-btn-text').show();

                if (data.save === true) {
                    message = showSuccessMessage(data.message);

                    $('.pxp-candidate-password-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');

                    $('#pxp-candidate-password-old').val('');
                    $('#pxp-candidate-password-new').val('');
                    $('#pxp-candidate-password-new-repeat').val('');
                } else {
                    if (data.field) {
                        var fields = data.field.split(',');

                        fields.forEach(field => {
                            if (field == 'old') {
                                $('#pxp-candidate-password-old')
                                .addClass('is-invalid');
                            } else if (field == 'new') {
                                $('#pxp-candidate-password-new')
                                .addClass('is-invalid');
                            } else if (field == 'new_r') {
                                $('#pxp-candidate-password-new-repeat')
                                .addClass('is-invalid');
                            }
                        });
                    }

                    message = showErrorMessage(data.message);

                    $('.pxp-candidate-password-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Candidate inbox - send message
    $('#pxp-candidate-dashboard-inbox-message-field').on('keydown', function(e) {
        if (e.keyCode === 13) {
            e.preventDefault();
            candidateInboxSendMessage();
        }
    });
    $('.pxp-candidate-dashboard-inbox-send-btn').on('click', function(e) {
        e.preventDefault();
        candidateInboxSendMessage();
    });
    function candidateInboxSendMessage() {
        $('.pxp-candidate-dashboard-inbox-send-btn').addClass('disabled');
        $('.pxp-candidate-dashboard-inbox-send-btn-text').hide();
        $('.pxp-candidate-dashboard-inbox-send-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'         : 'jobster_contact_company',
                'user_id'        : $('#pxp-candidate-dashboard-inbox-user-id').val(),
                'candidate_id'   : $('#pxp-candidate-dashboard-inbox-candidate-id').val(),
                'company_id'     : $('#pxp-candidate-dashboard-inbox-company-id').val(),
                'name'           : $('#pxp-candidate-dashboard-inbox-candidate-name').val(),
                'email'          : $('#pxp-candidate-dashboard-inbox-candidate-email').val(),
                'company_email'  : $('#pxp-candidate-dashboard-inbox-company-email').val(),
                'message'        : $('#pxp-candidate-dashboard-inbox-message-field').val(),
                'security'       : $('#pxp-candidate-inbox-security').val()
            },
            success: function(data) {
                $('.pxp-candidate-dashboard-inbox-send-btn').removeClass('disabled');
                $('.pxp-candidate-dashboard-inbox-send-btn-loading').hide();
                $('.pxp-candidate-dashboard-inbox-send-btn-text').show();

                if (data.sent === true) {
                    var avatarHolder = $('.pxp-candidate-dashboard-inbox-avatar-holder').html();
                    var message = $('#pxp-candidate-dashboard-inbox-message-field').val();
                    var newMessageHTML = 
                        `<div class="pxp-dashboard-inbox-messages-item mt-4">
                            <div class="row justify-content-end">
                                <div class="col-7">
                                    <div class="pxp-dashboard-inbox-messages-item-header flex-row-reverse">
                                        ${avatarHolder}
                                        <div class="pxp-dashboard-inbox-messages-item-time pxp-text-light me-3">
                                            ${data.time}
                                        </div>
                                    </div>
                                    <div class="pxp-dashboard-inbox-messages-item-message mt-2 pxp-is-self">
                                        ${message}
                                    </div>
                                </div>
                            </div>
                        </div>`;

                    $('.pxp-dashboard-inbox-messages-content').append(newMessageHTML);
                    $('#pxp-candidate-dashboard-inbox-message-field').val('');

                    var inboxContainer = $('.pxp-dashboard-inbox-messages-content');
                    inboxContainer[0].scrollTop = inboxContainer[0].scrollHeight;
                }
            },
            error: function(errorThrown) {}
        });
    }

    // Candidate Dashboard - Delete Notification
    $('.pxp-candidate-dashboard-delete-notify-btn').on('click', function() {
        var _self = $(this);
        _self.addClass('disabled');
        _self.find('.fa').hide();
        _self.find('.pxp-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'      : 'jobster_delete_candidate_notify',
                'offset'      : _self.attr('data-offset'),
                'candidate_id': _self.attr('data-candidate-id'),
                'security'    : $('#pxp-candidate-notifications-security').val()
            },
            success: function(data) {
                _self.removeClass('disabled');
                _self.find('.pxp-btn-loading').hide();
                _self.find('.fa').show();

                if (data.deleted === true) {
                    document.location.href = services_vars.candidate_notifications_url;
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Subscribe form service
    $('.pxp-subscribe-1-form-btn').click(function() {
        var message;
        $(this).addClass('disabled');
        $('.pxp-subscribe-1-form-btn-text').hide();
        $('.pxp-subscribe-1-form-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'  : 'jobster_save_subscription',
                'email'   : $('#pxp-subscribe-1-form-email').val(),
                'security': $('#pxp-subscribe-block-security').val()
            },
            success: function(data) {
                $('.pxp-subscribe-1-form-btn').removeClass('disabled');
                $('.pxp-subscribe-1-form-btn-loading').hide();
                $('.pxp-subscribe-1-form-btn-text').show();

                if (data.save === true) {
                    message = showSuccessMessage(data.message);

                    $('.pxp-subscribe-1-form-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                } else {
                    message = showErrorMessage(data.message);

                    $('.pxp-subscribe-1-form-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });

    // Manage send message with contact form block
    $('.pxp-contact-form-block-btn').on('click', function() {
        var message;
        $(this).addClass('disabled');
        $('.pxp-contact-form-block-btn-text').hide();
        $('.pxp-contact-form-block-btn-loading').show();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: services_vars.ajaxurl,
            data: {
                'action'       : 'jobster_contact_block_send',
                'name'         : $('#pxp-contact-form-block-name').val(),
                'email'        : $('#pxp-contact-form-block-email').val(),
                'company_email': $('#pxp-contact-form-block-company-email').val(),
                'message'      : $('#pxp-contact-form-block-message').val(),
                'security'     : $('#pxp-contact-form-block-security').val()
            },
            success: function(data) {
                $('.pxp-contact-form-block-btn').removeClass('disabled');
                $('.pxp-contact-form-block-btn-loading').hide();
                $('.pxp-contact-form-block-btn-text').show();

                if (data.sent === true) {
                    message = showSuccessMessage(data.message);

                    $('.pxp-contact-form-block-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                } else {
                    message = showErrorMessage(data.message);

                    $('.pxp-contact-form-block-response')
                    .empty()
                    .append(message)
                    .fadeIn('slow');
                }
            },
            error: function(errorThrown) {}
        });
    });
})(jQuery);